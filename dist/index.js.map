{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["import { useEffect } from 'react';\r\nimport {\r\n\tPingType,\r\n\tIsPollingType,\r\n\tGetPollingConfigType,\r\n\tUseOnlineEffectType,\r\n} from './types';\r\ndeclare global {\r\n    interface Window { _useOnlineEffect_: undefined | { \r\n\t\tpingerExist: boolean;\r\n\t\tcallbackList: Array<(online: boolean) => void>\r\n\t}; }\r\n}\r\n\r\nexport const needsPolling: IsPollingType = navigator => {\r\n\t// these browsers don't fully support navigator.onLine, so we need to use a polling backup\r\n\tconst unsupportedUserAgentsPattern = /Windows.*Chrome|Windows.*Firefox|Linux.*Chrome/;\r\n\r\n\tif (\r\n\t\ttypeof navigator !== 'undefined' &&\r\n\t\tunsupportedUserAgentsPattern.test(navigator.userAgent)\r\n\t) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\nexport const ping: PingType = ({ url, timeout }) => {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst isOnline = () => resolve();\r\n\t\tconst isOffline = () => reject();\r\n\r\n\t\tconst xhr = new XMLHttpRequest();\r\n\r\n\t\txhr.onerror = isOffline;\r\n\t\txhr.ontimeout = isOffline;\r\n\t\txhr.onreadystatechange = () => {\r\n\t\t\tif (xhr.readyState === xhr.HEADERS_RECEIVED) {\r\n\t\t\t\tif (xhr.status) {\r\n\t\t\t\t\tisOnline();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tisOffline();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\txhr.open('HEAD', url);\r\n\t\txhr.timeout = timeout;\r\n\t\txhr.send();\r\n\t});\r\n};\r\n\r\nconst getPollingConfigs: GetPollingConfigType = (\r\n\tpollingConfig,\r\n\tneedsPolling\r\n) => {\r\n\tconst defaultConfig = {\r\n\t\tenabled: true,\r\n\t\turl: 'https://ipv4.icanhazip.com/',\r\n\t\ttimeout: 5000,\r\n\t\tinterval: 5000,\r\n\t};\r\n\r\n\tif (\r\n\t\t(typeof pollingConfig === 'object' && pollingConfig.enabled === true) ||\r\n\t\t(needsPolling === true && typeof pollingConfig === 'object')\r\n\t) {\r\n\t\treturn { ...defaultConfig, ...pollingConfig };\r\n\t} else if (pollingConfig === true || needsPolling) {\r\n\t\treturn { ...defaultConfig };\r\n\t} else {\r\n\t\treturn { enabled: false };\r\n\t}\r\n};\r\n\r\nexport const useOnlineEffect: UseOnlineEffectType = (\r\n\tcallback,\r\n\tpollingOptions = {}\r\n) => {\r\n\tconst goOnline = () => {\r\n\t\tcallback(true);\r\n\t};\r\n\r\n\tconst goOffline = () => {\r\n\t\tcallback(false);\r\n\t};\r\n\r\n\t// does the browser support navigator.onLine CORRECTLY?\r\n\tconst mustPoll = needsPolling(navigator);\r\n\r\n\tconst { enabled, ...pingConfig } = getPollingConfigs(\r\n\t\tpollingOptions,\r\n\t\tmustPoll\r\n\t);\r\n\r\n\tuseEffect(() => {\r\n\t\t// initial online event fired.\r\n\t\tcallback(true);\r\n\r\n\t\twindow.addEventListener('online', goOnline);\r\n\t\twindow.addEventListener('offline', goOffline);\r\n\r\n\t\tpingConfig['callback'] = callback;\r\n\r\n\t\t// initialize setInterval id so we can clean up on unmount.\r\n\t\tlet intervalId: number | undefined;\r\n\r\n\t\t// hash config for key to store our actual config.\r\n    const hashedConfig: string = JSON.stringify({\r\n      ...pingConfig,\r\n      callback: pingConfig[\"callback\"] + \"\",\r\n    });\r\n\r\n    if ((mustPoll || enabled) && \"url\" in pingConfig && !window[hashedConfig]) {\r\n      window[hashedConfig] = { ...pingConfig };\r\n\r\n      const { url, timeout, interval, callback } = window[hashedConfig];\r\n      intervalId = setInterval(async () => {\r\n        try {\r\n          await ping({\r\n            url,\r\n            timeout,\r\n          });\r\n\r\n          console.log(\"CALLBACK: \", callback);\r\n          callback(true);\r\n        } catch (error) {\r\n          console.log(\"CALLBACK: \", callback);\r\n          callback(false);\r\n        }\r\n      }, interval);\r\n    }\r\n\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener('online', goOnline);\r\n\t\t\twindow.removeEventListener('offline', goOffline);\r\n\r\n\t\t\tif (mustPoll || enabled) {\r\n\t\t\t\tclearInterval(intervalId);\r\n\t\t\t}\r\n\t\t};\r\n\t}, []);\r\n};\r\n"],"names":["useEffect"],"mappings":"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"}